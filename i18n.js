const translations = {
    en: {
        toolTitle: 'Wiki File Base64 Fetcher',
        settingsTitle: 'Settings',
        settingsLangLabel: 'Interface language:',
        settingsApiLabel: 'Source wiki API endpoint:',
        settingsApiHelp: 'Required. The Action API URL of the wiki to fetch files from.',
        settingsAuthKeyLabel: 'X-authkey (Optional):',
        settingsAuthKeyWarn: 'Warning: huijiwiki.com API may require this parameter.',
        settingsSaveButton: 'Save',
        settingsApiMissing: 'API Endpoint cannot be empty. Settings not saved.',
        settingsSaved: 'Settings saved successfully!',
        step1Title: 'Step 1: Enter Filenames',
        step1Label: 'Source wiki filenames (e.g., File:Wiki.png), one per line, max {MAX_FILES}:',
        fetchButtonText: 'Fetch file information',
        fetchingMessage: 'Fetching information for {count} files…',
        fetchingSingleMessage: 'Fetching information for {filename}…',
        fetchCompleteMessage: 'Fetched information for {successCount} out of {totalCount} file(s). Please review below.',
        fetchNeedsSettings: 'Please configure the source wiki API endpoint in settings first.',
        fetchFileNameMissing: 'Please enter at least one filename.',
        fetchLineLimitExceeded: 'Too many filenames entered (max {MAX_FILES}).',
        fetchPrefixAdded: 'Note: “{prefix}:” prefix added to lines without a valid File namespace prefix.',
        step2Title: 'Step 2: Review & Edit',
        targetFilenameLabel: 'Target filename:',
        descriptionLabel: 'Description:',
        previewLabel: 'Preview:',
        previewPlaceholder: 'Loading preview…',
        previewFailed: 'Preview unavailable',
        generateJsonButtonText: 'Generate base64 JSON',
        step3Title: 'Step 3: Copy JSON',
        step3Label: 'Generated JSON ({fileCount} files, {totalSize} MB):',
        copyJsonButtonText: 'Copy JSON',
        gotoWikiButtonText: 'Go to Pleasant Goat Wiki',
        jsonGeneratedMessage: 'JSON generated. Copy the content above and paste it on the base64 upload page.',
        copySuccessMessage: 'JSON copied to clipboard!',
        copyErrorMessage: 'Failed to copy JSON.',
        generatingJsonMessage: 'Generating JSON and converting files to base64 (this may take a while)…',
        base64Error: 'Error converting file {filename} to base64.',
        fileSizeWarning: 'Warning: Total size ({totalSize} MB) is large, pasting/processing might be slow.',
        disclaimer: 'By using this tool, you confirm compliance with Pleasant Goat Wiki’s <a href="https://xyy.miraheze.org/wiki/Pleasant_Goat_Wiki:Copyrights" target="_blank">Copyright Policy</a> and <a href="https://xyy.miraheze.org/wiki/Pleasant_Goat_Wiki:File_Guidelines" target="_blank">File Guidelines</a>.',
        errorApiGeneric: 'API Error',
        errorApiStructure: 'Invalid API response structure.',
        errorFileNotFound: 'File “{filename}” not found on the source wiki.',
        errorImageInfoMissing: 'Could not get image information for “{filename}”. Is it an image file?',
        errorFileDownload: 'Failed to download file content for “{filename}”.',
        errorGenericFetch: 'Failed to fetch file information',
        errorGenericGenerate: 'Failed to generate JSON',
        errorNamespaceFetch: 'Failed to fetch namespace information from source wiki. Using default “File:”.',
        namespaceInfoLoading: 'Loading namespace information…',
        namespaceInfoLoaded: 'Namespace information loaded. Ready to fetch files.',
        namespaceInfoFailed: 'Failed to load namespace information. Using default “File:”.',
        initialSettingsRequired: 'Please enter the source wiki API endpoint and save settings to continue.'
    },
    zh: {
        toolTitle: '以base64获取wiki文件',
        settingsTitle: '设置',
        settingsLangLabel: '界面语言：',
        settingsApiLabel: '来源wiki API端点：',
        settingsApiHelp: '必需。要获取文件的wiki的Action API URL。',
        settingsAuthKeyLabel: 'X-authkey（可选）：',
        settingsAuthKeyWarn: '警告：huijiwiki.com的API可能需要此参数。',
        settingsSaveButton: '保存',
        settingsApiMissing: 'API端点不能为空。设置未保存。',
        settingsSaved: '设置已成功保存！',
        step1Title: '步骤1：输入文件名',
        step1Label: '来源wiki文件名（例如：File:Wiki.png），每行一个，最多{MAX_FILES}个：',
        fetchButtonText: '获取文件信息和内容',
        fetchingMessage: '正在获取{count}个文件的信息…',
        fetchingSingleMessage: '正在获取{filename}的文件信息…',
        fetchCompleteMessage: '已获取{totalCount}个文件中的{successCount}个信息。请在下方检查。',
        fetchNeedsSettings: '请先在“设置”中配置来源wiki API端点。',
        fetchFileNameMissing: '请输入至少一个文件名。',
        fetchLineLimitExceeded: '输入的文件名过多（最多{MAX_FILES}个）。',
        fetchPrefixAdded: '注意：已为部分缺少有效文件名字空间前缀的行自动添加“{prefix}:”前缀。',
        step2Title: '步骤2：检查与编辑',
        targetFilenameLabel: '目标文件名：',
        descriptionLabel: '描述：',
        previewLabel: '预览：',
        previewPlaceholder: '加载预览中…',
        previewFailed: '无法预览',
        generateJsonButtonText: '生成Base64 JSON',
        step3Title: '步骤3：复制JSON',
        step3Label: '生成的JSON（{fileCount}个文件，共{totalSize} MB）：',
        copyJsonButtonText: '复制JSON',
        gotoWikiButtonText: '前往Pleasant Goat Wiki',
        jsonGeneratedMessage: 'JSON已生成。复制上方内容并粘贴到base64上传页面。',
        copySuccessMessage: 'JSON已复制到剪贴板！',
        copyErrorMessage: '复制JSON失败。',
        generatingJsonMessage: '正在生成JSON并将文件转换为base64（可能需要一段时间）…',
        base64Error: '转换文件{filename}为base64时出错。',
        fileSizeWarning: '警告：总大小（{totalSize} MB）较大，粘贴或处理可能会缓慢。',
        disclaimer: '使用本工具即表示您确认遵守Pleasant Goat Wiki的<a href="https://xyy.miraheze.org/wiki/Pleasant_Goat_Wiki:Copyrights" target="_blank">著作权方针</a>和<a href="https://xyy.miraheze.org/wiki/Pleasant_Goat_Wiki:File_Guidelines" target="_blank">文件指引</a>。',
        errorApiGeneric: 'API错误',
        errorApiStructure: '无效的API响应结构。',
        errorFileNotFound: '文件“{filename}”在来源Wiki上不存在。',
        errorImageInfoMissing: '无法获取“{filename}”的图像信息。请确认它是图像文件。',
        errorFileDownload: '下载“{filename}”的文件内容失败。',
        errorGenericFetch: '获取文件信息失败',
        errorGenericGenerate: '生成JSON失败',
        errorNamespaceFetch: "无法从来源wiki获取名字空间信息。将使用默认前缀 'File:'。",
        namespaceInfoLoading: '正在加载名字空间信息…',
        namespaceInfoLoaded: '名字空间信息已加载，可以获取文件了。',
        namespaceInfoFailed: "加载名字空间信息失败，将使用默认前缀 'File:'。",
        initialSettingsRequired: '请填入来源wiki API端点并保存设置以继续。'
    }
};

function _t(key, replacements = {}) {
    let translation = translations[currentLang][key] || translations['en'][key] || `[${key}]`;
    for (const placeholder in replacements) {
        translation = translation.replace(`{${placeholder}}`, replacements[placeholder]);
    }
    return translation;
}
